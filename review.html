<section id="video-review" style="margin-top:40px;">
  <h3>üé¨ Video Review Tool</h3>
  <p>Select a movie clip from the list, watch it, and rate it 1‚Äì10.</p>

  <label for="videoSelect">Choose a clip:</label><br>
  <select id="videoSelect" style="margin-top:5px;">
    <option value="">-- Select a video --</option>
    <option value="https://drive.google.com/uc?export=download&id=1fns2A7stkoZZTtcSIaGDaT9Kgy_N5014">Clip 1 - Example A</option>
    <option value="https://drive.google.com/uc?export=download&id=1Ic1rEWEdQJTuHV7oqVGEuKlfM1TOzzZJ">Clip 2 - Example B</option>
    <option value="https://drive.google.com/uc?export=download&id=1z3EgOvi_dTzWTsmR-bOW_-7Vn_sVrT0S">Clip 3 - Example C</option>
  </select>

  <video id="videoPlayer" controls style="width:100%; max-width:600px; margin-top:15px; display:none;"></video>

  <div class="rating" style="margin-top:20px;">
    <label for="rating">Rate (1‚Äì10):</label>
    <input type="number" id="rating" min="1" max="10" style="width:60px;">
  </div>

  <button id="submitBtn" style="margin-top:20px; padding:10px 20px;">Submit Rating</button>
  <div class="message" id="message" style="margin-top:15px; font-weight:bold;"></div>
</section>

<script>
  const videoSelect = document.getElementById('videoSelect');
  const videoPlayer = document.getElementById('videoPlayer');
  const submitBtn = document.getElementById('submitBtn');
  const message = document.getElementById('message');
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxS0D6UG4THnw57NwtD90zIICn6-7vPyP1e0qaYjAnOQ2S21O-y1UTEoVfPzgJR4FsMBA/exec"; // Paste your Apps Script URL

  let videoName = '';
  let playTime = '';

  // Show selected video
  videoSelect.addEventListener('change', () => {
    const url = videoSelect.value;
    if (url) {
      videoName = videoSelect.options[videoSelect.selectedIndex].text;
      videoPlayer.src = url;
      videoPlayer.style.display = 'block';
      videoPlayer.load();
    } else {
      videoPlayer.style.display = 'none';
    }
  });

  // Record when the viewer starts playing
  videoPlayer.addEventListener('play', () => {
    playTime = new Date().toISOString();
  });

  // Fetch public IP (free API)
  async function getIP() {
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      return data.ip;
    } catch {
      return 'unknown';
    }
  }

  // Submit rating
  submitBtn.addEventListener('click', async () => {
    const rating = document.getElementById('rating').value;
    if (!rating || !videoName) {
      message.style.color = 'red';
      message.textContent = "‚ö†Ô∏è Please choose a video and enter a rating (1‚Äì10).";
      return;
    }

    const rateTime = new Date().toISOString();
    const ip = await getIP();

    const payload = {
      videoName,
      playTime,
      rateTime,
      rating,
      ip
    };

    try {
      await fetch(GOOGLE_SCRIPT_URL + "?ip=" + encodeURIComponent(ip), {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      message.style.color = 'green';
      message.textContent = "‚úÖ Rating recorded successfully!";
      document.getElementById('rating').value = '';
    } catch (err) {
      console.error(err);
      message.style.color = 'red';
      message.textContent = "‚ùå Error submitting rating.";
    }
  });
</script>
